@let getDragTarget = currentDragTarget();

<mat-card class="inventory-panel terminal">
	<mat-card-content [id]="'inventory-list'" class="inventory-list" cdkDropList cdkDropListSortingDisabled
	                  [cdkDropListData]="inventoryItems()"
	                  [cdkDropListConnectedTo]="[EquippedSlot.ARMOR, EquippedSlot.PRIMARY_WEAPON, EquippedSlot.SECONDARY_WEAPON]"
	                  (cdkDropListDropped)="onItemDropped($event)"
	                  (cdkDropListEntered)="onDropListEntered($event)"
	                  (cdkDropListExited)="onDropListExited()"
	>
		@for (item of inventoryItems(); track item.id) {
			@if (!(item.id === armorInstance()?.id || item.id === primaryWeaponInstance()?.id || item.id ===
				secondaryWeaponInstance()?.id)) {

				<mat-card class="inventory-item" cdkDrag
				          (click)="selectItem(item)"
				          (contextmenu)="showItemContextMenu($event, item)"
				          [cdkDragData]="item"
				          (cdkDragStarted)="onItemDragStarted()"
				          (cdkDragEnded)="onItemDragEnded()"
				>
					<img [ngSrc]="item.item.path" width="64" height="64" [alt]="item.item.names[currentLanguage()]"/>
					@if (item.item.type === ItemType.AMMO) {
						<span class="ammo-badge">x{{ (item | asItemInstance : ItemType.AMMO)?.quantity }}</span>
					}

					<!-- AperÃ§u pendant le drag -->
					<ng-template cdkDragPreview>
						<img [ngSrc]="item.item.path" width="64" height="64"
						     [alt]="item.item.names[currentLanguage()]"/>
					</ng-template>

					<!-- Placeholder pendant le drag vers un slot -->
					<ng-template cdkDragPlaceholder>
						@if (getDragTarget && getDragTarget !== 'inventory-list') {
							<mat-card class="mat-mdc-card-content slot-frame" [style.width.%]="100"
							          [style.height.%]="100">
								<img [ngSrc]="item.item.path" width="64" height="64"
								     [alt]="item.item.names[currentLanguage()]"/>
							</mat-card>
						} @else {
							<mat-card class="inventory-item"></mat-card>
						}
					</ng-template>
				</mat-card>
			}
		}
	</mat-card-content>
</mat-card>

<!-- Menu contextuel pour les actions sur les items de l'inventaire -->
<app-inventory-item-context-menu
	[contextMenuPosition]="contextMenuPosition()"
	[contextMenuItemInstance]="contextMenuItem()"
	[currentShowContextMenu]="showContextMenu()"
	(showContextMenu)="showContextMenu.set($event)"
/>
