@let getPlayer = player();

@let getPrimaryWeaponInstance = primaryWeaponInstance();
@let getSecondaryWeaponInstance = secondaryWeaponInstance();

@let getPrimaryWeaponItem = getPrimaryWeaponInstance?.item | asItem: ItemType.WEAPON;
@let getSecondaryWeaponItem = getSecondaryWeaponInstance?.item | asItem: ItemType.WEAPON;

@let getPrimaryWeaponMode = getPrimaryWeaponInstance?.currentWeaponMode;
@let getSecondaryWeaponMode = getSecondaryWeaponInstance?.currentWeaponMode;

<mat-card class="stats-section terminal">
	<mat-card-header>
		<mat-card-title>
			{{ 'game.inventory.stats.characteristics' | translate }}
		</mat-card-title>
	</mat-card-header>

	<mat-card-content>
		<section class="stats-detail-section">
			<section class="stats-grid-container">
				@if (getPlayer) {
					<!-- stats SPECIAL -->
					<mat-grid-list cols="2" rowHeight="32px" gutterSize="4">
						@let getSpecialsInstances = specialsInstances();
						@for (special of specials(); track special.id) {
							<mat-grid-tile [matTooltip]="special.names[currentLanguage()]"
							               [textContent]="special.shortNames[currentLanguage()]"/>
							<mat-grid-tile [textContent]="getSpecialsInstances.get(special.id)?.value ?? 0"/>
						}
					</mat-grid-list>

					@let hp = currentStats()?.hitPoints;

					<mat-grid-list cols="2" rowHeight="32px" gutterSize="4">
						<mat-grid-tile [matTooltip]="'game.inventory.stats.hitPoints' | translate"
						               [textContent]="'game.inventory.stats.others.hitPoints' | translate"/>
						<mat-grid-tile [textContent]="hp + ' / ' + hitPoints()"/>

						<!-- Stats d'armure -->
						<mat-grid-tile [matTooltip]="'game.stats.armorClass' | translate"
						               [textContent]="'game.inventory.stats.others.armorClass' | translate"/>
						<mat-grid-tile [textContent]="armorClass()"/>


						@for (damage of displayedDamages(); track damage.damageType) {
							@let names = damage.damageType.names;
							@if (names) {
								<mat-grid-tile [textContent]="names[currentLanguage()]"/>
							}
							<mat-grid-tile [textContent]="damage.threshold + ' / ' + damage.resistance + '%'"/>
						}
					</mat-grid-list>
				}
			</section>
		</section>

		<mat-divider></mat-divider>

		<!-- Stats des armes équipées -->
		<!-- Arme principale -->
		<mat-grid-list cols="6" rowHeight="32px" gutterSize="4">
			<mat-grid-tile colspan="6"
			               [textContent]="('game.inventory.weapons.primary' | translate) + ' : ' + (getPrimaryWeaponItem?.names?.[currentLanguage()] || 'game.inventory.weapons.noWeapon' | translate)">
			</mat-grid-tile>

			@if (getPrimaryWeaponInstance && getPrimaryWeaponItem && getPrimaryWeaponMode) {
				<mat-grid-tile colspan="2" [textContent]="'game.inventory.weapons.currentMode' | translate"/>
				<mat-grid-tile [textContent]="'game.inventory.weapons.damage' | translate"/>
				<mat-grid-tile [textContent]="'game.inventory.weapons.range' | translate"/>
				<mat-grid-tile [textContent]="'game.inventory.weapons.actionPoints' | translate"/>
				<mat-grid-tile [textContent]="'game.inventory.weapons.ammo' | translate"/>

				<mat-grid-tile colspan="2"
				               [textContent]="('game.inventory.weapons.modes.' + getPrimaryWeaponMode.modeType | translate) + ' ' + (getPrimaryWeaponMode | weaponModeIcon)"/>
				<mat-grid-tile [textContent]="getPrimaryWeaponMode.minDamage + '-' + getPrimaryWeaponMode.maxDamage"/>
				<mat-grid-tile [textContent]="getPrimaryWeaponMode.range + 'm'"/>
				<mat-grid-tile [textContent]="getPrimaryWeaponMode.actionPoints"/>
				<mat-grid-tile
					[textContent]="getPrimaryWeaponInstance.currentAmmoQuantity + '/' + getPrimaryWeaponItem.capacity"/>
			}
		</mat-grid-list>

		<mat-divider></mat-divider>

		<!-- Arme secondaire -->
		<mat-grid-list cols="6" rowHeight="32px" gutterSize="4">
			<mat-grid-tile colspan="6"
			               [textContent]="('game.inventory.weapons.secondary' | translate) + ' : ' + (getSecondaryWeaponItem?.names?.[currentLanguage()] || 'game.inventory.weapons.noWeapon' | translate)">
			</mat-grid-tile>

			@if (getSecondaryWeaponInstance && getSecondaryWeaponItem && getSecondaryWeaponMode) {
				<mat-grid-tile colspan="2" [textContent]="'game.inventory.weapons.currentMode' | translate"/>
				<mat-grid-tile [textContent]="'game.inventory.weapons.damage' | translate"/>
				<mat-grid-tile [textContent]="'game.inventory.weapons.range' | translate"/>
				<mat-grid-tile [textContent]="'game.inventory.weapons.actionPoints' | translate"/>
				<mat-grid-tile [textContent]="'game.inventory.weapons.ammo' | translate"/>

				<mat-grid-tile colspan="2"
				               [textContent]="('game.inventory.weapons.modes.' + getSecondaryWeaponMode.modeType | translate) + ' ' + (getSecondaryWeaponMode | weaponModeIcon)"/>
				<mat-grid-tile
					[textContent]="getSecondaryWeaponMode.minDamage + '-' + getSecondaryWeaponMode.maxDamage"/>
				<mat-grid-tile [textContent]="getSecondaryWeaponMode.range + ' m'"/>
				<mat-grid-tile [textContent]="getSecondaryWeaponMode.actionPoints"/>
				<mat-grid-tile
					[textContent]="getSecondaryWeaponInstance.currentAmmoQuantity + '/' + getSecondaryWeaponItem.capacity"/>
			}
		</mat-grid-list>
	</mat-card-content>
</mat-card>
